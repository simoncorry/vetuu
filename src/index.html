<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vetuu ‚Äî Drycross</title>
  <!-- CSS Modular Structure -->
  <link rel="stylesheet" href="styles/reset.css">
  <link rel="stylesheet" href="styles/_tokens.css">
  <link rel="stylesheet" href="styles/_base.css">
  <link rel="stylesheet" href="styles/_utilities.css">
  <link rel="stylesheet" href="styles/map.css">
  <link rel="stylesheet" href="styles/actors.css">
  <link rel="stylesheet" href="styles/combat.css">
  <link rel="stylesheet" href="styles/effects.css">
  <link rel="stylesheet" href="styles/ui.css">
  <link rel="stylesheet" href="styles/worldmap.css">
</head>
<body>
  <main id="game">
    <!-- Viewport: visible window into the map -->
    <section id="viewport" aria-label="Game world">
      <div id="world">
        <div id="ground-layer" class="layer"></div>
        <div id="object-layer" class="layer"></div>
        <div id="actor-layer" class="layer"></div>
        <div id="fog-layer" class="layer"></div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- MMO UI LAYOUT -->
    <!-- ============================================ -->

    <!-- Character Sheet (hidden by default, toggle with C) -->
    <aside id="character-sheet" aria-label="Character sheet">
      <header class="sheet-header">
        <h2>Character</h2>
        <button class="sheet-close" aria-label="Close">&times;</button>
      </header>
      <div id="sheet-stats">
        <div class="stat">
          <span class="stat-label">HP</span>
          <span class="stat-bar">
            <span id="hp-fill" class="stat-fill" style="--pct: 100"></span>
          </span>
          <span id="hp-text" class="stat-value">100/100</span>
        </div>
        <div class="stat">
          <span class="stat-label">Sense</span>
          <span class="stat-bar sense-bar">
            <span id="sense-fill" class="stat-fill" style="--pct: 100"></span>
          </span>
          <span id="sense-text" class="stat-value">20/20</span>
        </div>
        <div class="stat-row">
          <span class="stat-mini">ATK <strong id="atk-val">5</strong></span>
          <span class="stat-mini">DEF <strong id="def-val">3</strong></span>
          <span class="stat-mini">LCK <strong id="luck-val">1</strong></span>
        </div>
      </div>
      <div id="sheet-level">
        <span id="level-badge">Lv. <strong id="level-val">1</strong></span>
        <span class="xp-bar">
          <span id="xp-fill" class="stat-fill" style="--pct: 0"></span>
        </span>
        <span id="xp-text" class="stat-value">0/100</span>
      </div>
    </aside>

    <!-- Top Right: Minimap (draggable, resizable, zoomable) -->
    <aside id="minimap-container" aria-label="Minimap">
      <div id="minimap">
        <canvas id="minimap-canvas"></canvas>
        <canvas id="minimap-fog"></canvas>
      </div>
      <div id="minimap-label">Drycross Region</div>
      <div id="minimap-coords">X: 0 Y: 0</div>
    </aside>

    <!-- Quest Tracker (below minimap, draggable, resizable) -->
    <aside id="quest-tracker" aria-label="Active quests">
      <ul id="quest-list"></ul>
    </aside>

    <!-- Combat Log (left side, above action bar) -->
    <aside id="combat-log-container">
      <div id="combat-log"></div>
    </aside>

    <!-- ============================================ -->
    <!-- BOTTOM ACTION BAR AREA -->
    <!-- ============================================ -->

    <!-- Player Frame (above action bar, left side) -->
    <div id="player-frame" class="unit-frame">
      <div class="frame-drag-handle"></div>
      <div class="frame-portrait player-portrait">
        <span class="portrait-icon">üë§</span>
      </div>
      <div class="frame-info">
        <div class="frame-name-row">
          <span class="frame-name">Rex Kest</span>
          <span class="frame-level">Lv.<span id="player-frame-level">1</span></span>
        </div>
        <div class="frame-bar hp-bar">
          <span id="player-hp-fill" class="frame-hp-fill"></span>
          <span id="player-hp-text" class="frame-bar-text">100/100</span>
        </div>
        <div class="frame-bar sense-bar">
          <span id="player-sense-fill" class="frame-sense-fill"></span>
          <span id="player-sense-text" class="frame-bar-text">20/20</span>
        </div>
      </div>
      <div class="redock-indicator"><span>Release to dock</span></div>
    </div>

    <!-- Action Bar (center bottom) -->
    <nav id="action-bar" aria-label="Actions">
      <!-- Slot 1: Auto Attack (with swing timer border) -->
      <div class="auto-attack-slot-wrapper">
        <button id="auto-attack-slot" class="action-slot auto-slot" data-slot="1" data-action-type="auto" title="Auto Attack (1, Space)">
          <span id="auto-attack-icon" class="slot-icon">‚öîÔ∏è</span>
          <span id="auto-attack-label" class="slot-label">Attack</span>
          <span class="slot-key">1</span>
        </button>
        <!-- SVG stroke border for swing timer (GPU accelerated) -->
        <svg id="swing-timer-svg" class="swing-timer-border" viewBox="0 0 48 48">
          <!-- Path starts from top-center, goes clockwise -->
          <path class="swing-timer-track" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
          <path class="swing-timer-fill" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
        </svg>
      </div>
      
      <!-- Combat Abilities (2-5: melee + ranged, all share GCD) -->
      <div id="combat-abilities" class="action-group">
        <!-- Melee Skills (Slots 2-3) -->
        <button class="action-slot melee-slot" data-slot="2" data-action-type="ability" title="Leap - dash to target (8s CD)">
          <span class="slot-icon">ü¶ò</span>
          <span class="slot-label">Leap</span>
          <span class="slot-key">2</span>
          <div class="cooldown-overlay"></div>
          <span class="cooldown-timer"></span>
        </button>
        <div class="cast-slot-wrapper">
          <button class="action-slot melee-slot" data-slot="3" data-action-type="ability" title="Blade Flurry - 4 rapid strikes (8s CD)">
            <span class="slot-icon">‚öîÔ∏è</span>
            <span class="slot-label">Flurry</span>
            <span class="slot-key">3</span>
            <div class="cooldown-overlay"></div>
            <span class="cooldown-timer"></span>
          </button>
          <svg class="cast-timer-border" data-slot="3" viewBox="0 0 48 48">
            <path class="cast-timer-track" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
            <path class="cast-timer-fill" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
          </svg>
        </div>
        <!-- Ranged Skills (Slots 4-5) -->
        <button class="action-slot ranged-slot" data-slot="4" data-action-type="ability" title="Burst - 3 rapid shots (4s CD)">
          <span class="slot-icon">üí•</span>
          <span class="slot-label">Burst</span>
          <span class="slot-key">4</span>
          <div class="cooldown-overlay"></div>
          <span class="cooldown-timer"></span>
        </button>
        <div class="cast-slot-wrapper">
          <button class="action-slot ranged-slot" data-slot="5" data-action-type="ability" title="Charged Shot - powerful charge attack (10s CD)">
            <span class="slot-icon">üéØ</span>
            <span class="slot-label">Charged</span>
            <span class="slot-key">5</span>
            <div class="cooldown-overlay"></div>
            <span class="cooldown-timer"></span>
          </button>
          <svg class="cast-timer-border" data-slot="5" viewBox="0 0 48 48">
            <path class="cast-timer-track" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
            <path class="cast-timer-fill" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
          </svg>
        </div>
      </div>
      
      <div class="slot-divider sense-divider"></div>
      
      <!-- Sense Abilities (6-7, spends Sense + triggers GCD) -->
      <div id="sense-abilities" class="action-group">
        <button class="action-slot sense-slot" data-slot="6" data-action-type="sense" title="Pull - draw enemies toward you (6)">
          <span class="slot-icon">üß≤</span>
          <span class="slot-label">Pull</span>
          <span class="slot-key">6</span>
          <div class="cooldown-overlay"></div>
          <span class="cooldown-timer"></span>
        </button>
        <button class="action-slot sense-slot" data-slot="7" data-action-type="sense" title="Push - repel enemies away (7)">
          <span class="slot-icon">üí®</span>
          <span class="slot-label">Push</span>
          <span class="slot-key">7</span>
          <div class="cooldown-overlay"></div>
          <span class="cooldown-timer"></span>
        </button>
      </div>
      
      <div class="slot-divider"></div>
      
      <!-- Utility Abilities -->
      <div id="utility-abilities" class="action-group">
        <!-- Sprint slot with duration timer -->
        <div class="sprint-slot-wrapper">
          <button class="action-slot utility-slot" data-slot="sprint" data-action-type="utility" title="Sprint (R)">
            <span class="slot-icon">üèÉ</span>
            <span class="slot-label">Sprint</span>
            <span class="slot-key">R</span>
            <div class="cooldown-overlay"></div>
            <span class="cooldown-timer"></span>
          </button>
          <!-- SVG stroke border for sprint duration (GPU accelerated) -->
          <svg id="sprint-timer-svg" class="sprint-timer-border" viewBox="0 0 48 48">
            <path class="sprint-timer-track" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
            <path class="sprint-timer-fill" d="M24,1 L41,1 Q47,1 47,7 L47,41 Q47,47 41,47 L7,47 Q1,47 1,41 L1,7 Q1,1 7,1 Z"/>
          </svg>
        </div>
        <button class="action-slot utility-slot" data-slot="heal" data-action-type="utility" title="Heal (Q)">
          <span class="slot-icon">üíö</span>
          <span class="slot-label">Heal</span>
          <span class="slot-key">Q</span>
          <div class="cooldown-overlay"></div>
          <span class="cooldown-timer"></span>
        </button>
      </div>
    </nav>

    <!-- XP Bar (WoW-style, below action bar) -->
    <div id="xp-bar-container">
      <div id="xp-bar-track">
        <div id="xp-bar-fill"></div>
        <div id="xp-bar-notches">
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
          <span class="xp-notch"></span>
        </div>
      </div>
      <div id="xp-bar-text">
        <span id="xp-bar-level">Lv.1</span>
        <span id="xp-bar-progress">0 / 100 XP</span>
      </div>
    </div>

    <!-- Target Frame (above action bar, right side) -->
    <div id="target-frame" class="unit-frame hidden">
      <div class="frame-drag-handle"></div>
      <div class="frame-info">
        <div class="frame-name-row">
          <span class="frame-name">Enemy</span>
          <span class="frame-level">Lv.1</span>
        </div>
        <div class="frame-bar hp-bar">
          <span class="frame-hp-fill"></span>
          <span class="frame-hp-text">100/100</span>
        </div>
      </div>
      <div class="frame-portrait enemy-portrait">
        <span class="portrait-icon">üëπ</span>
      </div>
      <div class="redock-indicator"><span>Release to dock</span></div>
    </div>

    <!-- ============================================ -->
    <!-- DIALOGS & OVERLAYS -->
    <!-- ============================================ -->

    <!-- Dialogue panel -->
    <dialog id="dialogue-panel" aria-label="Dialogue">
      <header id="dialogue-speaker"></header>
      <p id="dialogue-text"></p>
      <menu id="dialogue-choices"></menu>
    </dialog>

    <!-- Inventory panel -->
    <dialog id="inventory-panel" aria-label="Inventory">
      <header>
        <h2>Inventory</h2>
        <button id="inventory-close" aria-label="Close inventory">&times;</button>
      </header>
      <ul id="inventory-list"></ul>
    </dialog>

    <!-- Interaction prompt -->
    <div id="interact-prompt" class="hidden">
      <kbd>E</kbd> <span id="interact-label">Interact</span>
    </div>

    <!-- Combat panel (legacy, hidden) -->
    <dialog id="combat-panel" aria-label="Combat"></dialog>

    <!-- Toast notifications -->
    <div id="toast-container" aria-live="polite"></div>
  </main>

  <!-- World Map Overlay (hidden by default, toggle with M) -->
  <div id="worldmap-overlay" aria-label="World Map">
    <!-- Map Viewport (main canvas area) -->
    <div id="worldmap-viewport">
      <canvas id="worldmap-terrain"></canvas>
      <canvas id="worldmap-overlay-canvas"></canvas>
      
      <!-- Zoom indicator -->
      <div id="worldmap-zoom">1x</div>
      
      <!-- Current region/position -->
      <div id="worldmap-position">Drycross</div>
      
      <!-- Current map center coords -->
      <div id="worldmap-coords">X: 0 Y: 0</div>
      
      <!-- Recenter on player button (shown when panned away) -->
      <button id="worldmap-center-player" class="hidden">Recenter</button>
    </div>
    
    <!-- Right Panel (filters + quests) -->
    <aside id="worldmap-panel">
      <header class="worldmap-panel-header">
        <h2>World Map</h2>
        <button class="worldmap-close" aria-label="Close">&times;</button>
      </header>
      
      <div class="worldmap-panel-content">
        <!-- Filters -->
        <section class="worldmap-section">
          <h3 class="worldmap-section-title">Show</h3>
          <div class="worldmap-filters">
            <label class="worldmap-filter">
              <input type="checkbox" id="filter-quests" checked>
              <span class="worldmap-filter-icon">‚ùó</span>
              <span class="worldmap-filter-label">Quests</span>
            </label>
            <label class="worldmap-filter">
              <input type="checkbox" id="filter-merchants" checked>
              <span class="worldmap-filter-icon">üõí</span>
              <span class="worldmap-filter-label">Merchants</span>
            </label>
            <label class="worldmap-filter">
              <input type="checkbox" id="filter-save-points" checked>
              <span class="worldmap-filter-icon">üíæ</span>
              <span class="worldmap-filter-label">Save Points</span>
            </label>
            <label class="worldmap-filter">
              <input type="checkbox" id="filter-fast-travel" checked>
              <span class="worldmap-filter-icon">‚ö°</span>
              <span class="worldmap-filter-label">Fast Travel</span>
            </label>
            <label class="worldmap-filter">
              <input type="checkbox" id="filter-waypoints" checked>
              <span class="worldmap-filter-icon">üìç</span>
              <span class="worldmap-filter-label">Waypoints</span>
            </label>
          </div>
        </section>
        
        <!-- Active Quests -->
        <section class="worldmap-section">
          <h3 class="worldmap-section-title">Active Quests</h3>
          <div id="worldmap-quest-list" class="worldmap-quest-list">
            <!-- Populated by JS -->
          </div>
        </section>
        
        <!-- Custom Waypoints -->
        <section class="worldmap-section">
          <h3 class="worldmap-section-title">Waypoints</h3>
          <div id="worldmap-waypoint-list" class="worldmap-waypoint-list">
            <!-- Populated by JS -->
          </div>
        </section>
      </div>
    </aside>
  </div>

  <!-- Settings Menu (hidden by default, toggle with Esc) -->
  <aside id="settings-menu" aria-label="Settings">
    <header class="settings-header">
      <h2>Settings</h2>
      <button class="settings-close" aria-label="Close">&times;</button>
    </header>
    <div class="settings-content">
      <section class="settings-section">
        <h3>Controls</h3>
        <div class="controls-list">
          <p><kbd>Click</kbd> Move / Interact</p>
          <p><kbd>R-Click</kbd> Attack target</p>
          <p><kbd>Tab</kbd> Cycle targets</p>
          <p><kbd>~</kbd><kbd>Space</kbd> Toggle weapon</p>
          <p><kbd>1</kbd><kbd>2</kbd><kbd>3</kbd> Weapon abilities</p>
          <p><kbd>4</kbd><kbd>5</kbd><kbd>6</kbd> Sense abilities</p>
          <p><kbd>R</kbd> Sprint</p>
          <p><kbd>Q</kbd> Heal</p>
        </div>
      </section>
      <section class="settings-section">
        <h3>UI Shortcuts</h3>
        <div class="controls-list">
          <p><kbd>C</kbd> Character Sheet</p>
          <p><kbd>I</kbd> Inventory</p>
          <p><kbd>M</kbd> World Map</p>
          <p><kbd>Ctrl/‚åò</kbd>+<kbd>M</kbd> Toggle Minimap</p>
          <p><kbd>Ctrl/‚åò</kbd>+<kbd>J</kbd> Toggle Quests</p>
          <p><kbd>Esc</kbd> Settings / Close</p>
        </div>
      </section>
      <section class="settings-section">
        <h3>Game</h3>
        <button id="reset-btn" title="Reset all game data">üîÑ Reset Progress</button>
      </section>
    </div>
  </aside>

  <script type="module" src="js/game.js"></script>
</body>
</html>
